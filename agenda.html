<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pure JS Agenda</title>
</head>
<link rel="stylesheet" type="text/css" href="./css/style.css">
<script type="application/javascript">

// Guardaremos los contactos en este array
// Las variables declaradas fuera de las funciones son globales
let personas = []
// Guardaremos en esta variable la persona que esté seleccionada
let idPersonaSel = null

let trSeleccionado = null

function insertarPersona(){
    let persona = {
        id        : Math.round(Math.random()*10000),
        nombre    : document.getElementById("nombre").value,
        direccion : document.getElementById("direccion").value,
        telefono  : document.getElementById("telefono").value,
        correoE   : document.getElementById("correoE").value,
    }
    //La añadimos al array
    personas.push(persona)
    //Actualizamos la tabla
    rellenarTabla()
}

function rellenarFormulario(persona){
    idPersonaSel = persona.id
    document.getElementById("nombre").value    = persona.nombre
    document.getElementById("direccion").value = persona.direccion
    document.getElementById("telefono").value  = persona.telefono
    document.getElementById("correoE").value   = persona.correoE
}

function rellenarTabla(){
    let tablaPersonas = document.getElementById("tablaPersonas")
    tablaPersonas.innerHTML = ""
    for(let persona of personas){
        let tr   = document.createElement("tr")
        let td1  = document.createElement("td")
        let td2  = document.createElement("td")
        let td3  = document.createElement("td")
        let td4  = document.createElement("td")
        let txt1 = document.createTextNode(persona.nombre)
        let txt2 = document.createTextNode(persona.direccion)
        let txt3 = document.createTextNode(persona.telefono)
        let txt4 = document.createTextNode(persona.correoE)
        td1.append(txt1)
        td2.append(txt2)
        td3.append(txt3)
        td4.append(txt4)
        tr.append(td1, td2, td3, td4)

        //Esta funcion es una función anidada
        //Ej JS las funciones anidadas son closures
        //Cuando se declara una función anidada que utiliza una variable de la función nido
        //la funcion anidada tendrá declarada de manera implícita dicha variable con el valor
        //correspondiente es su contexto
        tr.onclick = function(){
            //La variable persona no está declarada aqui!
            rellenarFormulario(persona)
            tr.style.background = "#FABADA"
            if(trSeleccionado){
                trSeleccionado.style.background = "white"
            }
            trSeleccionado = tr
        }
        tablaPersonas.append(tr)
    }
}

function inicializar(){
    document.getElementById("btnInsertar").onclick  = insertarPersona
}

window.onload = inicializar
</script>

<body>
    <div class="container">
        <h1>Pure JS Agenda</h1>
        <div>
            <input type="button" id="btnInsertar"  value="Insertar"/>
        </div>
        <br/>
        <form id="formulario">
            <table>
                <tr>
                    <td>Name</td>
                    <td>
                        <input type="text" name="nombre" id="nombre"/>
                    </td>
                    <td id="msj_nombre"></td>
                </tr>
                <tr>
                    <td>Address</td>
                    <td>
                        <input type="text" name="direccion" id="direccion"/>
                    </td>
                    <td id="msj_direccion"></td>
                </tr>
                <tr>
                    <td>Phone</td>
                    <td>
                        <input type="text" name="telefono" id="telefono"/>
                    </td>
                    <td id="msj_telefono"></td>
                </tr>
                <tr>
                    <td>Em@il</td>
                    <td>
                        <input type="text" name="correoE" id="correoE"/>
                    </td>
                    <td id="msj_correoE"></td>
                </tr>
            </table>
        </form>

        <br/>

        <table>
            <tr>
                <th>Name</th>
                <th>Address</th>
                <th>Phone</th>
                <th>Em@ail</th>
            </tr>
            <tbody id="tablaPersonas"></tbody>
        </table>
    </div>
</body>
</html>

